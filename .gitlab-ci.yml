image: node:14

stages:
  - build
  - package
  - deploy

build:
  stage: build
  before_script:
  - npm install
  script:
    - npm run build

package:
  stage: package
  script:
    - mkdir artifacts
    - tar -czvf artifacts/app.tar.gz build/

deploy:
  stage: deploy
  script:
    - apt-get install -y putty-tools
    - echo y | plink.exe -ssh -pw $SSH_PASSWORD $SSH_USER@$SSH_HOST "mkdir -p /var/www/html"
    - psftp.exe -pw $SSH_PASSWORD $SSH_USER@$SSH_HOST -b - <<EOF
        put -r build/ /var/www/html/
        quit
      EOF

